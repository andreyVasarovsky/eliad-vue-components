import{openBlock as e,createElementBlock as t,createElementVNode as n,toDisplayString as s,Fragment as i,renderList as r,createTextVNode as a,normalizeClass as d,createCommentVNode as o}from"vue";var l={name:"InputText"};const c={type:"text"};l.render=function(n,s,i,r,a,d){return e(),t("input",c)},l.__file="src/InputText.vue";var g={name:"InputTextarea"};g.render=function(n,s,i,r,a,d){return e(),t("textarea")},g.__file="src/InputTextarea.vue";var u={name:"av-drag-and-drop",emits:["change","mounted","update:modelValue"],props:{stack:{type:Array,required:!0,default:()=>[]},containers:{type:Array,required:!1,default:()=>[]},elementsTitles:{type:Object,required:!1,default:()=>({})},containersTitles:{type:Object,required:!1,default:()=>({})},mainTitle:{type:String,required:!1,default:"Stack"},disabledContainers:{type:Array,required:!1,default:()=>[]},maxInContainer:{type:Object,required:!1,default:()=>({})},modelValue:Object},data:()=>({editable:{stack:[],containers:{}},dragged:null,draggingTargetId:null}),watch:{modelValue(){this.setup()}},mounted(){this.setup(),document.addEventListener("dragstart",this.onDragStart,!1),document.addEventListener("dragend",this.onDragEnd,!1),document.addEventListener("dragover",this.onDragOver,!1),document.addEventListener("drop",this.onDrop,!1),this.$emit("mounted")},beforeUnmount(){document.removeEventListener("dragstart",this.onDragStart,!1),document.removeEventListener("dragend",this.onDragEnd,!1),document.removeEventListener("dragover",this.onDragOver,!1),document.removeEventListener("drop",this.onDrop,!1)},methods:{setup(){this.editable.stack=this.stack,Object.keys(this.modelValue).length>0?this.editable.containers=this.modelValue:this.containers.map((e=>{this.editable.containers[e]=[]}))},showError(e){this.$refs.error.innerHTML=e,this.$refs.error.classList.toggle("error-msg-hidden"),setTimeout((()=>{this.$refs.error.classList.toggle("error-msg-hidden")}),2e3)},bindDraggable(e){this.$refs[e][0].classList.contains("disabled")||(this.$refs[e][0].setAttribute("draggable",!0),this.$refs[e][0].style.transform="translateZ(0px)")},onDragStart(e){this.dragged=e.target,e.dataTransfer.effectAllowed="copyMove"},onDragEnd(){this.draggableElementIds.includes(this.dragged.id)&&this.dragged.setAttribute("draggable",!1)},onDragOver(e){e.preventDefault(),this.draggingTargetId=null,this.resetDraggableElementsBottomBorder();const t=e.target.id;""!==t&&this.draggableElementIds.includes(t)&&(document.getElementById(t).style.borderTop="solid 1px #409eff",this.draggingTargetId=t)},resetDraggableElementsBottomBorder(){this.draggableElementIds.map((e=>{document.getElementById(e).style.borderTop=""}))},getElementPath(e){if(void 0===e.path){let t=[],n=e.target;for(;n;)t.push(n),n=n.parentElement;return t}return e.path},onDrop(e){e.preventDefault(),this.resetDraggableElementsBottomBorder();let t=null;if(this.getElementPath(e).forEach((e=>{if(void 0!==e.classList&&e.classList.contains("dropzone"))return t=e,!1})),t){const e=t.id,n=this.dragged.id,s=this.draggingTargetId;this.draggableElementIds.includes(n)&&n!==s&&(e in this.maxInContainer&&parseInt(this.maxInContainer[e])===parseInt(this.containersQty[e])?this.showError("Quantity limit"):(this.removeFromStack(n),this.removeFromContainers(n),"stack"===e?this.pushInStack(n):this.pushInContainer(e,n),this.$emit("change",this.editable.containers),this.$emit("update:modelValue",this.editable.containers)))}},removeFromContainers(e){Object.keys(this.editable.containers).map((t=>{let n=this.editable.containers[t].indexOf(e);-1!==n&&this.editable.containers[t].splice(n,1)}))},removeFromStack(e){let t=this.editable.stack.indexOf(e);-1!==t&&this.editable.stack.splice(t,1)},pushInContainer(e,t){if(!this.editable.containers[e].includes(t)){const n=this.draggingTargetId;null!==n?this.editable.containers[e].splice(this.editable.containers[e].indexOf(n),0,t):this.editable.containers[e].push(t)}},pushInStack(e){if(!this.editable.stack.includes(e)){const t=this.draggingTargetId;null!==t?this.editable.stack.splice(this.editable.stack.indexOf(t),0,e):this.editable.stack.push(e)}}},computed:{containersQty(){let e={};return Object.keys(this.editable.containers).map((t=>{e[t]=this.editable.containers[t].length})),e},draggableElementIds(){const e=new Set;return this.stack.map((t=>e.add(t))),Object.values(this.editable.containers).map((t=>t.map((t=>{e.add(t)})))),[...e]}}};const h={class:"drag-and-drop-box"},m={class:"drop-zones container-list"},p={class:"container main dropzone",id:"stack"},b={class:"title"},f={class:"element-list"},v=["id","onMousedown"],y=["id"],k={class:"title"},I={key:2,class:"limit"},E={class:"element-list"},T=["id","onMousedown"],D={ref:"error",class:"error-msg error-msg-hidden"};u.render=function(l,c,g,u,x,O){return e(),t("div",h,[n("div",m,[n("div",p,[n("div",b,s(g.mainTitle),1),n("div",f,[(e(!0),t(i,null,r(x.editable.stack,((n,r)=>(e(),t("div",{ref_for:!0,ref:n,id:n,key:r,class:"element",onMousedown:e=>O.bindDraggable(n)},[n in g.elementsTitles?(e(),t(i,{key:0},[a(s(g.elementsTitles[n]),1)],2112)):(e(),t(i,{key:1},[a(s(n),1)],2112))],40,v)))),128))])]),(e(!0),t(i,null,r(x.editable.containers,((l,c)=>(e(),t("div",{key:c,class:d([{disabled:g.disabledContainers.includes(c),dropzone:!g.disabledContainers.includes(c)},"container"]),id:c},[n("div",k,[c in g.containersTitles?(e(),t(i,{key:0},[a(s(g.containersTitles[c]),1)],2112)):(e(),t(i,{key:1},[a(s(c),1)],2112)),c in g.maxInContainer?(e(),t("span",I,"("+s(O.containersQty[c])+"/"+s(g.maxInContainer[c])+")",1)):o("v-if",!0)]),n("div",E,[(e(!0),t(i,null,r(l,((n,r)=>(e(),t("div",{ref_for:!0,ref:n,id:n,key:r,class:d(["element",{disabled:g.disabledContainers.includes(c)}]),onMousedown:e=>O.bindDraggable(n)},[n in g.elementsTitles?(e(),t(i,{key:0},[a(s(g.elementsTitles[n]),1)],2112)):(e(),t(i,{key:1},[a(s(n),1)],2112))],42,T)))),128))])],10,y)))),128))]),n("div",D,null,512)])},u.__scopeId="data-v-3f0d3494",u.__file="src/AVDragAndDrop.vue";var x={InputTextarea:g,InputText:l,AVDragAndDrop:u};const O={install(e){for(const t in x)if(x.hasOwnProperty(t)){const n=x[t];e.component(n.name,n)}}};export{O as default};
